<%
  inline_form = [:inline, :search].member?(options[:builder].options[:type])
  
  control_group_class  = 'control-group'
  control_group_class << " cg-#{options[:method].to_s.dasherize}" if options[:method]
  control_group_class << ' error'                                 if options[:errors]
  
  if ([:prepend, :append] & options.keys).present?
    wrapper_class = "#{wrapper_class} input-prepend".strip  if options[:prepend]
    wrapper_class = "#{wrapper_class} input-append".strip   if options[:append]
  end
%>

<%= content_tag_unless(inline_form, :div, :class => control_group_class) do %>
  
  <% unless ['', false].include?(options[:label]) %>
    <%= options[:builder].label(options[:method], options[:label], :class => 'control-label') %>
  <% end %>
  
  <%= content_tag_unless(inline_form, :div, :class => 'controls') do %>
    
    <%= content_tag_if(wrapper_class, :div, :class => wrapper_class) do %>
      <%= content_tag(:span, options[:prepend], :class => 'add-on') if options[:prepend] %>
      <%= options[:content] %>
      <%= content_tag(:span, options[:append], :class => 'add-on') if options[:append] %>
    <% end %>
    
    <%= content_tag(:span, options[:errors], :class => 'help-inline') if options[:errors] %>
    <%= content_tag(:span, options[:help_block], :class => 'help-block') if options[:help_block] %>
  <% end %>
  
<% end %>